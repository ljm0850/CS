# 병렬성과 비동기성(컴퓨터는 어떻게 한 번에 많은 일을 하는가)

- **경합조건** : 잔고가 100만원인 계좌에서 동시에 75만원과 50만원을 인출하려는 경우
  - 은행에서는 계좌를 잠가서 둘 중 한개의 거래만 처리
  - 일부 연산에 대해서는 근본적으로 멀티태스킹을 막아야 함을 의미

## 경합조건?

- 경합 조건은 2개 이상의 프로그램이 같은 자원에 동시에 접근하고, 자원 사용 순서에 따라 결과가 달라지는 경우를 뜻함

| 프로그렘 1             | 프로그렘 2             | 잔고     | 프로그렘1              | 프로그렘2              | 잔고     |
| ---------------------- | ---------------------- | -------- | ---------------------- | ---------------------- | -------- |
|                        |                        | 100만 원 |                        |                        | 100만 원 |
| 100만 원 읽음          |                        | 100만 원 | 100만 원 읽음          |                        | 100만 원 |
| 읽은 값에 10만 원 더함 |                        | 100만 원 | 읽은 값에 10만 원 더함 |                        | 100만 원 |
| 110만 원 write         |                        | 110만 원 |                        | 100만 원 읽음          | 100만 원 |
|                        | 110만 원 읽음          | 110만 원 |                        | 읽은 값에 50만 원 더함 | 100만 원 |
|                        | 읽은 값에 50만 원 더함 | 110만 원 | 110만원 write          |                        | 110만 원 |
|                        | 160만 원 write         | 160만 원 |                        | 150만 원 write         | 150만 원 |

- 공유 자원(계좌)에 접근하는 타이밍에 따라 달라짐

## 

## 프로세스와 스레드

- 운영체제는 **프로세스**를 관리
  - 프로세스는 **사용자 공간**에서 독립적으로 실행되는 프로그렘

- 멀티코어 시스템에서는 여러 프로그렘이 병렬로 실행될 수 있음

- 프로세스가 자원을 공유하려면 미리 준비를 해야함

  - 자원을 공유하는 프로세스 사이에 통신을 해야 한다는 뜻

  

- **스레드**: 정적인 데이터와 힙을 **공유**하지만, 자체적으로 스택을 갖는 프로그램의 일부분

- 각 스레드는 자신이 CPU 레지스터를 완전하 소유한다고 가정

  - 따라서 한 스레드에서 다른 스레드로 실행이 넘어갈 때는 스레드 스케줄러가 CPU 레지스터를 저장해야함
  - 스레드는 일반 프로세스보다 저장할 컨텍스트 크기가 훨씬 작기 때문에 프로세스 문맥 전환보다 스레드 문맥 전환이 빠름
  - 경량 프로세스 라고 부르기도 함

- 스레드의 문제점

  - 데이터를 공유하기에 보안 문제 발생
  - 한 탭에서 문제가 생기거나 버그가 발생시 전체 프로세스가 멈춰버림
  - 어떤 스레드가 작업완료에 너무 많은 시간이 걸리면 다른 스레드가 실행되지 못해서 문제 발생



